<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gym Warriors - Treinos</title>
  <link rel="stylesheet" href="style/treinos.css">
  <link rel="icon" type="image/png" href="../assets/logo.png">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <main class="container">
    <h1>Treino do Dia</h1>
    <h2 id="treinoDoDia">Carregando...</h2>
    <button id="btnProximo" disabled>Pr√≥ximo Treino</button>
    <div id="exerciciosContainer"></div>
  </main>

  <nav class="tab-bar">
    <a href="home.html" class="tab"><ion-icon name="home-outline"></ion-icon><span>Home</span></a>
    <a href="treinos.html" class="tab active"><ion-icon name="barbell-outline"></ion-icon><span>Treinos</span></a>
    <a href="progresso.html" class="tab"><ion-icon name="stats-chart-outline"></ion-icon><span>Progresso</span></a>
    <a href="perfil.html" class="tab"><ion-icon name="person-outline"></ion-icon><span>Perfil</span></a>
  </nav>

  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

  <script>
    // ================================
    // üîπ FIREBASE CONFIG
    // ================================
    const firebaseConfig = {
      apiKey: "AIzaSyAbVJUTwovjKHua6OWP_yIncKYytEEwPfo",
      authDomain: "tcc-994f7.firebaseapp.com",
      projectId: "tcc-994f7",
      storageBucket: "tcc-994f7.appspot.com",
      messagingSenderId: "848443566233",
      appId: "1:848443566233:web:b9be3b2beccb027fa53008"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ================================
    // üîπ VARI√ÅVEIS GLOBAIS
    // ================================
    let usuario = null;
    let equipamentosUsuario = [];
    let objetivoUsuario = "";

    const treinoElem = document.getElementById("treinoDoDia");
    const btnProximo = document.getElementById("btnProximo");
    const container = document.getElementById("exerciciosContainer");

    const mapaTreinos = {
      "Treino A": ["peito", "triceps"],
      "Treino B": ["costas", "biceps"],
      "Treino C": ["pernas", "ombros"]
    };

    // ================================
    // üîπ EXERC√çCIOS (resumidos)
    // ================================
    const exercicios = {
  pernas: [
    { equipamento: "Halteres", exercicio: "Agachamento leve", foco: ["Resist√™ncia", "Funcional"] },
    { equipamento: "Halteres", exercicio: "Passada (avan√ßo)", foco: ["Crescimento", "For√ßa"] },
    { equipamento: "Barra", exercicio: "Agachamento livre pesado", foco: ["For√ßa", "Crescimento"] },
    { equipamento: "Kettlebell", exercicio: "Goblet squat", foco: ["Funcional", "Mobilidade"] },
    { equipamento: "El√°stico", exercicio: "Agachamento com el√°stico", foco: ["Mobilidade", "Resist√™ncia"] },
    { equipamento: "Esteira", exercicio: "Caminhada inclinada", foco: ["Aer√≥bico", "Resist√™ncia"] },
    { equipamento: "Esteira", exercicio: "Corrida leve", foco: ["Aer√≥bico", "Resist√™ncia"] },
    { equipamento: "Corda", exercicio: "Saltos simples", foco: ["Coordena√ß√£o", "Resist√™ncia"] },
    { equipamento: "Corda", exercicio: "Double unders", foco: ["Coordena√ß√£o", "Explos√£o"] },
    { equipamento: "Corpo", exercicio: "Pistol squat", foco: ["For√ßa", "Controle corporal", "Equil√≠brio"] },
    { equipamento: "Corda naval", exercicio: "Ondas com agachamento", foco: ["For√ßa", "Explos√£o", "Resist√™ncia"] },
    { equipamento: "Barra", exercicio: "Stiff", foco: ["Crescimento", "For√ßa"] },
    { equipamento: "Halteres", exercicio: "Afundo b√∫lgaro", foco: ["For√ßa", "Equil√≠brio"] },
    { equipamento: "Kettlebell", exercicio: "Deadlift unilateral", foco: ["Funcional", "Mobilidade", "For√ßa"] },
    { equipamento: "Corpo", exercicio: "Ponte de gl√∫teo", foco: ["Resist√™ncia", "Crescimento"] },
    { equipamento: "El√°stico", exercicio: "Cadeira extensora com el√°stico", foco: ["Mobilidade", "Resist√™ncia"] },
    { equipamento: "Corda naval", exercicio: "Saltos laterais com corda", foco: ["Aer√≥bico", "Explos√£o"] }
  ],

  ombros: [
    { equipamento: "Halteres", exercicio: "Eleva√ß√£o lateral sentada", foco: ["Resist√™ncia", "Crescimento"] },
    { equipamento: "Halteres", exercicio: "Desenvolvimento militar", foco: ["Crescimento", "For√ßa"] },
    { equipamento: "Barra", exercicio: "Desenvolvimento em p√©", foco: ["For√ßa", "Crescimento"] },
    { equipamento: "El√°stico", exercicio: "Eleva√ß√£o frontal", foco: ["Mobilidade", "Resist√™ncia"] },
    { equipamento: "Kettlebell", exercicio: "Press alternado", foco: ["Funcional", "For√ßa"] },
    { equipamento: "Kettlebell", exercicio: "Turkish get-up", foco: ["Mobilidade", "Controle corporal", "Funcional"] },
    { equipamento: "Corpo", exercicio: "Pike push-up", foco: ["For√ßa", "Resist√™ncia"] },
    { equipamento: "Corpo", exercicio: "Handstand push-up", foco: ["For√ßa", "Controle corporal", "Explos√£o"] },
    { equipamento: "Corda naval", exercicio: "Golpes laterais", foco: ["Funcional", "Resist√™ncia"] },
    { equipamento: "Halteres", exercicio: "Eleva√ß√£o posterior", foco: ["Crescimento", "Isolamento"] },
    { equipamento: "Barra", exercicio: "Push press", foco: ["For√ßa", "Explos√£o"] },
    { equipamento: "El√°stico", exercicio: "Rota√ß√£o externa", foco: ["Mobilidade", "Preven√ß√£o de les√µes"] },
    { equipamento: "Corpo", exercicio: "Planche lean", foco: ["Controle corporal", "For√ßa"] },
    { equipamento: "Corda naval", exercicio: "Golpes diagonais", foco: ["Funcional", "Explos√£o"] }
  ],

  costas: [
    { equipamento: "Halteres", exercicio: "Remada unilateral apoiada", foco: ["Crescimento", "For√ßa"] },
    { equipamento: "Halteres", exercicio: "Remada curvada", foco: ["For√ßa", "Crescimento"] },
    { equipamento: "Barra", exercicio: "Barra fixa pronada", foco: ["For√ßa", "Resist√™ncia"] },
    { equipamento: "El√°stico", exercicio: "Remada sentada", foco: ["Resist√™ncia", "Mobilidade"] },
    { equipamento: "El√°stico", exercicio: "Puxada alta", foco: ["Funcional", "Mobilidade"] },
    { equipamento: "Kettlebell", exercicio: "Remada com kettlebell", foco: ["Funcional", "For√ßa"] },
    { equipamento: "Corpo", exercicio: "Muscle-up", foco: ["For√ßa", "Explos√£o", "Controle corporal"] },
    { equipamento: "Corda naval", exercicio: "Ondas alternadas", foco: ["Resist√™ncia", "For√ßa"] },
    { equipamento: "Barra", exercicio: "Levantamento terra", foco: ["For√ßa", "Crescimento", "Explos√£o"] },
    { equipamento: "Halteres", exercicio: "Pullover", foco: ["Crescimento", "Resist√™ncia"] },
    { equipamento: "El√°stico", exercicio: "Face pull", foco: ["Mobilidade", "Preven√ß√£o de les√µes"] },
    { equipamento: "Corpo", exercicio: "Superman", foco: ["Resist√™ncia", "Mobilidade"] },
    { equipamento: "Kettlebell", exercicio: "High pull", foco: ["Funcional", "Explos√£o"] }
  ],

  peito: [
    { equipamento: "Halteres", exercicio: "Supino reto leve", foco: ["Crescimento", "For√ßa"] },
    { equipamento: "Halteres", exercicio: "Supino inclinado", foco: ["For√ßa", "Crescimento"] },
    { equipamento: "Barra", exercicio: "Supino pesado", foco: ["Crescimento", "For√ßa", "Explos√£o"] },
    { equipamento: "El√°stico", exercicio: "Crucifixo com el√°stico", foco: ["Mobilidade", "Isolamento"] },
    { equipamento: "Kettlebell", exercicio: "Supino no ch√£o", foco: ["Funcional", "For√ßa"] },
    { equipamento: "Corpo", exercicio: "Flex√£o inclinada", foco: ["Resist√™ncia", "Funcional"] },
    { equipamento: "Corpo", exercicio: "Flex√£o tradicional", foco: ["For√ßa", "Crescimento"] },
    { equipamento: "Corpo", exercicio: "Flex√£o com palmas", foco: ["Explos√£o", "Coordena√ß√£o"] },
    { equipamento: "Corda naval", exercicio: "Golpes cruzados", foco: ["Funcional", "Resist√™ncia"] },
    { equipamento: "Halteres", exercicio: "Crucifixo reto", foco: ["Crescimento", "Isolamento"] },
    { equipamento: "Barra", exercicio: "Supino declinado", foco: ["For√ßa", "Crescimento"] },
    { equipamento: "El√°stico", exercicio: "Press de peito", foco: ["Resist√™ncia", "Mobilidade"] },
    { equipamento: "Corpo", exercicio: "Flex√£o arqueada", foco: ["Mobilidade", "Controle corporal"] },
    { equipamento: "Kettlebell", exercicio: "Floor press", foco: ["Funcional", "For√ßa"] }
  ],

  biceps: [
    { equipamento: "Halteres", exercicio: "Rosca alternada", foco: ["Resist√™ncia", "Crescimento"] },
    { equipamento: "Halteres", exercicio: "Rosca martelo", foco: ["Crescimento", "For√ßa"] },
    { equipamento: "Barra", exercicio: "Rosca direta pesada", foco: ["For√ßa", "Crescimento"] },
    { equipamento: "El√°stico", exercicio: "Rosca com el√°stico", foco: ["Mobilidade", "Resist√™ncia"] },
    { equipamento: "Kettlebell", exercicio: "Rosca neutra", foco: ["Funcional", "For√ßa"] },
    { equipamento: "Corpo", exercicio: "Chin-up", foco: ["Crescimento", "For√ßa"] },
    { equipamento: "Halteres", exercicio: "Rosca concentrada", foco: ["Crescimento", "Isolamento"] },
    { equipamento: "Barra", exercicio: "Rosca 21", foco: ["Resist√™ncia", "Crescimento"] },
    { equipamento: "El√°stico", exercicio: "Rosca inversa", foco: ["Mobilidade", "Resist√™ncia"] },
    { equipamento: "Kettlebell", exercicio: "Rosca unilateral", foco: ["Funcional", "Resist√™ncia"] }
  ],

  triceps: [
    { equipamento: "Halteres", exercicio: "Coice de tr√≠ceps", foco: ["Resist√™ncia", "Isolamento"] },
    { equipamento: "Halteres", exercicio: "Tr√≠ceps franc√™s", foco: ["Crescimento", "For√ßa"] },
    { equipamento: "Barra", exercicio: "Tr√≠ceps testa", foco: ["For√ßa", "Crescimento"] },
    { equipamento: "El√°stico", exercicio: "Extens√£o com el√°stico", foco: ["Mobilidade", "Resist√™ncia"] },
    { equipamento: "Kettlebell", exercicio: "Extens√£o acima da cabe√ßa", foco: ["Funcional", "For√ßa"] },
    { equipamento: "Corpo", exercicio: "Paralelas (dips)", foco: ["For√ßa", "Crescimento", "Controle corporal"] },
    { equipamento: "Corda naval", exercicio: "Ondas curtas", foco: ["Resist√™ncia", "Explos√£o"] },
    { equipamento: "Halteres", exercicio: "Kickback unilateral", foco: ["Resist√™ncia", "Isolamento"] },
    { equipamento: "Barra", exercicio: "Fechamento de supino", foco: ["For√ßa", "Crescimento"] },
    { equipamento: "Corpo", exercicio: "Flex√£o diamante", foco: ["Crescimento", "Resist√™ncia"] },
    { equipamento: "El√°stico", exercicio: "Tr√≠ceps pull-down", foco: ["Resist√™ncia", "Mobilidade"] }
  ]
};

    // ================================
    // üîπ CALCULAR S√âRIES E REPETI√á√ïES
    // ================================
    function calcularTreino(usuario, foco) {
      const { idade, peso, sexo, objetivo } = usuario;
      let series = 3, repeticoes = 12;

      // Ajuste por idade
      if (idade < 20) repeticoes += 2;
      if (idade > 40) repeticoes -= 2;

      // Ajuste por peso
      if (peso > 85) series += 1;
      if (peso < 60) repeticoes += 2;

      // Ajuste por sexo
      if (sexo === "masculino") series += 1;
      else repeticoes += 2;

      // Ajuste pelo objetivo principal
      switch (objetivo) {
        case "For√ßa": series += 1; repeticoes -= 4; break;
        case "Crescimento": series += 1; break;
        case "Resist√™ncia": repeticoes += 4; break;
        case "Funcional": repeticoes += 1; break;
        case "Mobilidade": series -= 1; repeticoes += 6; break;
        case "Aer√≥bico": series -= 1; repeticoes += 8; break;
      }

      // Ajuste pelo foco do exerc√≠cio
      if (foco.includes(objetivo)) series += 1;

      // Limites
      series = Math.max(2, Math.min(series, 6));
      repeticoes = Math.max(6, Math.min(repeticoes, 20));

      return { series, repeticoes };
    }

    // ================================
    // üîπ AUTENTICA√á√ÉO
    // ================================
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        treinoElem.textContent = "Fa√ßa login para ver seus treinos.";
        return;
      }

      const doc = await db.collection("usuarios").doc(user.uid).get();
      if (!doc.exists) {
        treinoElem.textContent = "Usu√°rio n√£o encontrado.";
        return;
      }

      usuario = doc.data();
      equipamentosUsuario = usuario.equipamentos || [];
      objetivoUsuario = usuario.objetivo || "";

      treinoElem.textContent = `Clique no bot√£o para ver seu treino do dia (objetivo: ${objetivoUsuario}).`;
      btnProximo.disabled = false;
    });

    // ================================
    // üîπ MOSTRAR EXERC√çCIOS
    // ================================
    btnProximo.addEventListener("click", () => {
      const treinos = Object.keys(mapaTreinos);
      const ultimo = localStorage.getItem("ultimoTreino");
      let proximo = treinos[0];

      if (ultimo && treinos.includes(ultimo)) {
        const idx = treinos.indexOf(ultimo);
        proximo = treinos[(idx + 1) % treinos.length];
      }

      localStorage.setItem("ultimoTreino", proximo);
      treinoElem.textContent = `Treino do dia: ${proximo} (${objetivoUsuario})`;
      mostrarExercicios(proximo);
    });

    function mostrarExercicios(treinoDoDia) {
      container.innerHTML = "";
      const grupos = mapaTreinos[treinoDoDia];
      let encontrados = 0;

      grupos.forEach(grupo => {
        const lista = exercicios[grupo].filter(ex =>
          equipamentosUsuario.includes(ex.equipamento) &&
          ex.foco.includes(objetivoUsuario)
        );

        if (lista.length > 0) {
          const grupoDiv = document.createElement("div");
          grupoDiv.innerHTML = `<h3>${grupo.toUpperCase()}</h3>`;

          lista.forEach(ex => {
            const item = document.createElement("div");
            item.classList.add("exercicio-item");
            item.innerHTML = `<p><strong>${ex.exercicio}</strong> (${ex.equipamento})</p>`;
            item.addEventListener("click", () => mostrarDetalhes(ex));
            grupoDiv.appendChild(item);
          });

          container.appendChild(grupoDiv);
          encontrados += lista.length;
        }
      });

      if (encontrados === 0) {
        container.innerHTML = "<p>Nenhum exerc√≠cio compat√≠vel com seu objetivo e equipamentos.</p>";
      }
    }

    // ================================
    // üîπ DETALHES DO EXERC√çCIO
    // ================================
    function mostrarDetalhes(ex) {
      const { series, repeticoes } = calcularTreino(usuario, ex.foco);
      container.innerHTML = `
        <h2>${ex.exercicio}</h2>
        <p>Equipamento: ${ex.equipamento}</p>
        <p>Foco: ${ex.foco.join(", ")}</p>
        <p><strong>${series} s√©ries de ${repeticoes} repeti√ß√µes</strong></p>
        <button id="btnRealizar">Realizar Exerc√≠cio</button>
        <button id="btnVoltar">Voltar</button>
      `;

      document.getElementById("btnRealizar").addEventListener("click", async () => {
        const registro = {
          exercicio: ex.exercicio,
          equipamento: ex.equipamento,
          series,
          repeticoes,
          objetivo: usuario.objetivo,
          data: new Date().toISOString()
        };

        const user = auth.currentUser;
        if (!user) return;

        await db.collection("usuarios").doc(user.uid)
          .collection("progresso")
          .add(registro);

        alert("‚úÖ Exerc√≠cio registrado com sucesso!");
        btnProximo.click();
      });

      document.getElementById("btnVoltar").addEventListener("click", () => {
        const ultimo = localStorage.getItem("ultimoTreino");
        mostrarExercicios(ultimo);
      });
    }
  </script>
</body>
</html>
