<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Warriors - Perfil</title>
    <link rel="stylesheet" href="style/perfil.css" />
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>
    <div class="container">
        <div class="form-box">
            <h2>Perfil</h2>
            <div class="perfil-info">
                <p><strong>Nome:</strong> <span id="userName">Carregando...</span></p>
                <p><strong>Idade:</strong> <span id="perfilIdade">Carregando...</span></p>
                <p><strong>Peso:</strong> <span id="perfilPeso">Carregando...</span></p>
                <p><strong>Altura:</strong> <span id="perfilAltura">Carregando...</span></p>
                <p><strong>Objetivo:</strong> <span id="perfilObjetivo">Carregando...</span></p>
                <p><strong>Equipamentos:</strong> <span id="perfilEquipamentos">Carregando...</span></p><br />

                <button id="editEquipamentosBtn">Editar Equipamentos</button> 
                <button id="editarPerfilBtn">Editar Perfil</button>
                
                <!-- Bot√£o de Logout -->
                <button id="logoutBtn" style="margin-top: 20px;">Sair da Conta</button>
            </div>
        </div>
    </div>

    <!-- üü¢ Barra de Navega√ß√£o Inferior -->
    <nav class="tab-bar">
        <a href="home.html" style="text-decoration: none;" class="tab">
            <ion-icon name="home-outline"></ion-icon>
            <span>Home</span>
        </a>
        <a href="treinos.html" style="text-decoration: none;" class="tab">
            <ion-icon name="barbell-outline"></ion-icon>
            <span>Treinos</span>
        </a>
        <a href="progresso.html" style="text-decoration: none;" class="tab">
            <ion-icon name="stats-chart-outline"></ion-icon>
            <span>Progresso</span>
        </a>
        <a href="perfil.html" style="text-decoration: none;" class="tab active">
            <ion-icon name="person-outline"></ion-icon>
            <span>Perfil</span>
        </a>
    </nav>

    <!-- √çcones do Ionic -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <script>
        // Configura√ß√£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAbVJUTwovjKHua6OWP_yIncKYytEEwPfo",
            authDomain: "tcc-994f7.firebaseapp.com",
            projectId: "tcc-994f7",
            storageBucket: "tcc-994f7.firebasestorage.app",
            messagingSenderId: "848443566233",
            appId: "1:848443566233:web:b9be3b2beccb027fa53008",
            measurementId: "G-SGB2LYMT17",
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Monitorar autentica√ß√£o do usu√°rio
        auth.onAuthStateChanged((user) => {
            if (user) {
                db.collection("usuarios")
                    .doc(user.uid)
                    .get()
                    .then((doc) => {
                        if (doc.exists) {
                            const dados = doc.data();
                            document.getElementById("userName").textContent = user.displayName || "---";
                            document.getElementById("perfilIdade").textContent = dados.idade || "---";
                            document.getElementById("perfilPeso").textContent = dados.peso || "---";
                            document.getElementById("perfilAltura").textContent = dados.altura || "---";
                            document.getElementById("perfilObjetivo").textContent = dados.objetivo || "---";

                            if (dados.equipamentos && dados.equipamentos.length > 0) {
                                document.getElementById("perfilEquipamentos").textContent = dados.equipamentos.join(", ");
                            } else {
                                document.getElementById("perfilEquipamentos").textContent = "Nenhum equipamento selecionado";
                            }
                        } else {
                            document.querySelector(".perfil-info").innerHTML = "<p style='font-family: Poppins;'><strong>Dados n√£o encontrados.</strong></p><br><p>Por favor, termine de realizar seu <a href='cadastro2.html' style='text-decoration:none; color: #FFFF;'><strong>cadastro</strong></a></p>";
                        }
                    })
                    .catch((err) => {
                        console.error("Erro ao buscar dados do usu√°rio:", err);
                    });
            } else {
                window.location.href = "login.html";
            }
        });

        // Bot√£o editar equipamentos
        document.getElementById("editEquipamentosBtn")?.addEventListener("click", () => {
            window.location.href = "cadastro3.html";
        });

        // Bot√£o editar perfil
        document.getElementById("editarPerfilBtn")?.addEventListener("click", () => {
            window.location.href = "editPerfil.html";
        });

        // Bot√£o logout
        document.getElementById("logoutBtn")?.addEventListener("click", () => {
            auth.signOut().then(() => window.location.href = "login.html");
        });

        // Corre√ß√£o do erro "tabs is not defined"
        const tabs = document.querySelectorAll(".tab");
        tabs.forEach((tab) => {
            tab.addEventListener("click", () => {
                tabs.forEach((t) => t.classList.remove("active"));
                tab.classList.add("active");
            });
        });
    </script>
</body>

</html>
